<div class="card border-0 shadow-sm p-3 mb-3 bg-white" id="comment-{{ comment.id }}" style="border-radius: 15px;">
    <div class="d-flex justify-content-between align-items-center mb-2">
        <span class="text-dark fw-bold">
            <i class="fas fa-user-circle me-1 text-muted"></i> {{ comment.author }}
        </span>
        
        <div class="d-flex align-items-center gap-2">
            <small class="text-muted">{{ comment.created_at|date:"d.m.Y H:i" }}</small>
            
            {% if user.is_authenticated %}
                {% if user == comment.author or user == comment.post.author %}
                <div class="dropdown">
                    <button class="btn btn-link text-muted p-0 border-0 shadow-none" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-ellipsis-v" style="width: 20px; text-align: center;"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end shadow border-0" style="border-radius: 10px;">
                        {% if user == comment.author %}
                        <li>
                            <a class="dropdown-item edit-comment-trigger" 
                               href="#" 
                               data-id="{{ comment.id }}" 
                               data-raw-text="{{ comment.text }}">
                                <i class="fas fa-edit me-2 text-muted"></i> Edytuj
                            </a>
                        </li>
                        {% endif %}
                        <li>
                            <a class="dropdown-item text-danger delete-comment-btn" href="#" data-id="{{ comment.id }}">
                                <i class="fas fa-trash-alt me-2"></i> Usu≈Ñ
                            </a>
                        </li>
                    </ul>
                </div>
                {% endif %}
            {% endif %}
        </div>
    </div>
    
    <div class="comment-content-wrapper">
        <p class="mb-3 text-dark comment-text" style="line-height: 1.5;">{{ comment.text|linebreaks }}</p>
    </div>

    <div class="d-flex align-items-center gap-3">
        <button class="btn btn-sm like-comment-btn 
            {% if user.is_authenticated %}
                {% if user in comment.likes.all %}btn-primary{% else %}btn-outline-primary{% endif %}
            {% else %}
                btn-outline-secondary disabled
            {% endif %}"
            style="border-radius: 8px; font-weight: 600;"
            data-id="{{ comment.id }}">
            <span style="pointer-events:none;">üëç <span class="comment-like-count">{{ comment.likes.count }}</span></span>
        </button>

        {% if user.is_authenticated %}
            <small class="text-muted fw-bold" onclick="document.getElementById('reply-form-{{ comment.id }}').classList.toggle('d-none')" style="cursor: pointer; font-size: 0.85rem;">
                <i class="fas fa-reply me-1"></i> Odpowiedz
            </small>
        {% endif %}
    </div>

    {% if user.is_authenticated %}
    <form method="POST" action="{% url 'add_comment' post.pk %}" id="reply-form-{{ comment.id }}" class="reply-form mt-3 d-none">
        {% csrf_token %}
        <textarea name="text" rows="2" class="form-control mb-2 shadow-sm" 
                  style="border-radius: 10px; border: 1px solid #dee2e6;" 
                  placeholder="Napisz odpowied≈∫..."></textarea>
        <input type="hidden" name="parent_id" value="{{ comment.id }}">
        <button type="submit" class="btn-comment-submit" style="padding: 6px 15px; font-size: 0.85rem;">
            Wy≈õlij odpowied≈∫
        </button>
    </form>
    {% endif %}

    <div class="ms-4 border-start ps-3 mt-3">
        {% for reply in comment.replies.all|dictsort:"created_at" %}
            {% include "comments/comment.html" with comment=reply %}
        {% endfor %}
    </div>
</div>